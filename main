from random import *
from enum import Enum
import time 

class PlayerData:
    def __init__(self, name, adress):
        self.name = name
        self.id
        self.adress = adress
        self.port
        




class Choice:
    def __init__(self, type, plys, strs, instruct):
        self.id = "choix" + str(randint(0, 1000))
        
        self.type = type
        self.plys = plys
        self.strs = strs
        self.instruct = instruct
        
        """
        type = 1 -> choix de joueur, ne pas considérer la liste str
        type = 2 -> choix str parmis proposés (4 max)
        type = 3 -> choix booléan
        
        """
        self.receipt = {plys[i].name: False for i in len(plys)}
        self.answer = {plys[i].name: "" for i in len(plys)}
        
    def run(self):
        pass

    def getAnswers(self):
        return self.answer
        
        








class Game:
    def __init__(self, id, plys, roles, statuts):
        self.id = id
        self.plys = plys
        self.plysData = {}
        self.roles = {}
        self.statuts = {}
        self.nightNb = 1
        self.finished = False
        self.choices = []
        self.choice = []
        
        rolesLists = {1: ["Diablotin"]; 2: ["Diablotin", "Enquêteur"]}
        self.schedule = {}
        
        
        
    def chat(self, players, str, isFromSystem, fromPlayer = ""):
        pass
        
        
    def start(self):
        self.chat(self.plys, "La partie commence: ", True, "")
        self.chat(self.plys, "Attribution des rôles ", True, "")
        
        
        #distribution des rôles
        rolesCopie = self.rolesLists[len(plys)]
        for ply in plys:
            x = randint(0, len(rolesCopie) - 1)
            self.roles[ply] = rolesCopie[x]
            self.chat([ply], ("Vous êtes" + self.roles[ply]), False, "")
            rolesCopie.remove(x)
            
            
        
    
        self.night(self.nightNb)
        
        while (!self.finished):
            for k in self.schedule.keys():
                if time() - k > self.schedule[k][0]:
                    if self.schedule[k][1] == "night":
                        self.night()
                    elif self.schedule[k][1] == "day":
                        self.day()
                    elif self.schedule[k][1] == "vote":
                        self.vote()
                    elif self.schedule[k][1] == "voteEnd":
                        self.endVote(self.schedule[k][2])
                    
    
    
    
    
   
    def nightAct(role, ply):
        pass
    
    
    
    
    def night(self):
        
        for ply in self.plys:
            self.nightAct(self.roles[ply], ply)
            
        self.nightNb = self.nightNb + 1
        self.schedule[time()] = (120, "day", self.nightNb)
        
    
    def morningAct:
        pass 
    
    
    def day(self):
        
        self.chat(self.plys, "le jour se lève et les joueurs suivants sont morts ", True, "")
        for st in self.statuts.keys():
            if not self.statuts[st];
                chat(self.plys, st, True, "")
        
        for ply in self.plys:
            self.morningAct(self.roles[ply], ply)
    
        self.schedule[time()] = (120, "vote", self.nightNb)
        
            
        
        
        
    def getChoice(self, id):
        for c in self.choices:
            if c.id == id:
                return c
    
    def vote(self):
        
        self.chat(self.plys, "Les votes commencent, veuillez choisir qui mourra ce matin: ", True, "")
        
        votes = Choice(1, self.plys, [], "Choisissez un joueur à éliminer")
        votes.run()
        
        self.choices.append(votes)
        self.schedule[time()] = (120, "VoteEnd", votes.id)
        
        
        
    def onDied(self, ply):
        pass
        
    def endVote(self, id):
        voted = {}
        for k in getChoice(id).answer.keys():
            if not voted[getChoice(id).answer[k]]==null:
                voted[getChoice(id).answer[k]] = voted[getChoice(id).answer[k]] + 1
            else:
                voted[getChoice(id).answer[k]] = 1
                
                
        mostVoted = ""
        for ply in self.plys:
            if mostVoted == "" or voted[ply] > voted[mostVoted]:
                mostVoted = ply
                
                
        self.chat(self.plys, ("Les votes se finissent: ainsi le joueur exécuté sera: "+mostVoted), True, "")
        self.statuts[ply] = False
        self.onDied(ply)
        
        if roles[ply] == "Diablotin":
            self.chat(self.plys, (mostVoted+ " était diablotin, les citadins ont gagnés"), True, "")
            self.finished = true
            
            
        wonByD = True
        #Calculer si diable a gagné
        
        self.nightNb = self.nightNb + 1
        self.night()
        
    
        
